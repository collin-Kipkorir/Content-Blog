<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reading Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
      <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<style>
     button.text-blue-600 {
        font-size: 14px;
    }
  @media (max-width: 640px) {
    #comment-form input, #comment-form textarea {
      font-size: 14px;
    }
    #comment-form button {
      font-size: 14px;
    }
  }
</style>

<body class="bg-gray-50 text-gray-800 font-sans">
   <!-- Header -->
<header class="bg-gray-900 text-gray-100 p-4 sticky top-0 z-50 shadow-md">
  <div class="container mx-auto flex justify-between items-center">
    
    <!-- Logo and Brand -->
    <div class="flex items-center space-x-2">
      <img src="images/hot_logo.webp" alt="Hot News Logo" class="h-10 w-auto">
      <span class="text-2xl md:text-3xl tracking-wider hover:text-red-500 transition-all cursor-pointer">
        Bright Facts
      </span>

    </div>
    
    <!-- Navigation -->
    <nav class="hidden md:block">
      <ul class="flex space-x-6 text-sm font-medium">
        <li><a href="#" class="hover:text-red-500 transition-all">Home</a></li>
        <li><a href="#articles" class="hover:text-red-500 transition-all">Articles</a></li>
        <li><a href="#about" class="hover:text-red-500 transition-all">About</a></li>
        <li><a href="#topics" class="hover:text-red-500 transition-all">Topics</a></li>
      </ul>
    </nav>
    
    <!-- Mobile Menu Button -->
    <button id="menu-toggle" class="md:hidden p-2 rounded text-gray-400 hover:text-red-500 focus:outline-none">
      <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </div>
  
  <!-- Mobile Navigation -->
  <div id="mobile-menu" class="hidden md:hidden mt-4">
    <ul class="space-y-2 text-sm font-medium">
      <li><a href="#" class="block hover:text-red-500 transition-all">Home</a></li>
      <li><a href="#articles" class="block hover:text-red-500 transition-all">Articles</a></li>
      <li><a href="#about" class="block hover:text-red-500 transition-all">About</a></li>
      <li><a href="#topics" class="block hover:text-red-500 transition-all">Topics</a></li>
    </ul>
  </div>
</header>


    <!-- Main Content -->
    <div class="container mx-auto p-4 grid grid-cols-1 md:grid-cols-12 gap-6">
        <aside class="hidden md:block md:col-span-3 lg:col-span-2">
            <ul id="social-links" class="space-y-3"></ul>
        </aside>

        <div class="md:col-span-9 lg:col-span-7">
            <nav class="text-sm text-gray-800 mb-4 flex items-center space-x-2">
                <a href="index.html" class="hover:underline text-red-500">Home</a>
                <span>&gt;</span>
                <a href="index.html" class="hover:underline text-red-500">Articles</a>
                <span>&gt;</span>
                <span id="breadcrumb-title" class="font-semibold text-gray-700 truncate max-w-full sm:max-w-xs overflow-hidden inline-block"></span>
            </nav>

            <h2 id="article-title" class="text-xl md:text-3xl font-bold mb-4"></h2>
            <div id="article-image" class="my-4 rounded-lg overflow-hidden"></div>
            <div id="article-content" class="space-y-4 text-justify leading-relaxed"></div>
            <form id="comment-form" class="space-y-4 p-4 bg-white shadow-lg rounded-lg">
              <label for="commenter-name" class="block text-sm font-semibold text-gray-700">Name</label>
              <input id="commenter-name" type="text" placeholder="Name" 
                     class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500 sm:text-base text-sm" 
                     required />
          
              <label for="comment-input" class="block text-sm font-semibold text-gray-700">Comment</label>
              <textarea id="comment-input" placeholder="Add a comment..." 
                        class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 focus:outline-none focus:ring-2 focus:ring-red-500 sm:text-base text-sm" 
                        required></textarea>
          
              <button type="submit" 
                      class="w-full bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-300 transition duration-200 sm:text-base text-sm">
                  Post Comment
              </button>
              <div id="comments-list">
                <!-- Comments will be loaded here -->
            </div>
          </form>
          
          
        </div>

        <aside class="md:col-span-12 lg:col-span-3">
            <h3 class="text-lg font-bold mb-3">Popular</h3>
            <ul id="trending-news" class="space-y-3"></ul>

            <h3 class="text-lg font-bold mt-6 mb-3">Subscribe</h3>
            <form id="subscription-form" class="flex flex-col space-y-3">
                <input type="email" placeholder="Enter your email" class="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-600" required>
                <button type="submit" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700">Subscribe</button>
            </form>
        </aside>

    </div>

    <input type="hidden" id="encoded-content" value="EncodedContentHere">
<!-- HTML structure for displaying messages -->
<div id="message-container" class="hidden">
  <p id="message-text" class="font-bold"></p>
</div>

<!-- Subscription form -->
<form id="subscription-form">
  <input type="email" placeholder="Enter your email" required>
  <button type="submit">Subscribe</button>
</form>

 <!-- Footer -->
<footer class="bg-gray-900 text-gray-300 py-10">
  <div class="container mx-auto px-4">
    
    <!-- Top Section: Newsletter and Socials -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <!-- Newsletter -->
      <div>
        <h3 class="text-xl font-bold mb-3">Subscribe for Timeless Insights</h3>
        <p class="text-sm mb-4">Get curated evergreen content delivered directly to your inbox.</p>
        <form id="subscription-form"" class="flex">
          <input type="email" placeholder="Enter your email" 
                 class="w-full p-3 rounded-l-md bg-gray-800 border border-gray-700 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500"
                 required>
          <button type="submit"
                  class="bg-red-600 text-white px-4 py-3 rounded-r-md hover:bg-red-500 transition-all">Subscribe</button>
        </form>
      </div>
      
      <!-- Social Media Links -->
      <div>
        <h3 class="text-xl font-bold mb-3">Follow Us</h3>
        <p class="text-sm mb-4">Join our community for more updates and timeless knowledge.</p>
        <div class="flex space-x-6">
          <a href="#" aria-label="Facebook" class="hover:text-blue-500 transition-all"><i class="fab fa-facebook-f fa-lg"></i></a>
          <a href="#" aria-label="Twitter" class="hover:text-blue-400 transition-all"><i class="fab fa-twitter fa-lg"></i></a>
          <a href="#" aria-label="LinkedIn" class="hover:text-blue-600 transition-all"><i class="fab fa-linkedin fa-lg"></i></a>
          <a href="#" aria-label="YouTube" class="hover:text-red-500 transition-all"><i class="fab fa-youtube fa-lg"></i></a>
        </div>
      </div>
    </div>
    
    <!-- Middle Section: Navigation and Popular Categories -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mt-10">
      <!-- Quick Links -->
      <div>
        <h4 class="text-lg font-semibold mb-3">Quick Links</h4>
        <ul class="space-y-2">
          <li><a href="#" class="hover:text-gray-400 transition-all">Privacy Policy</a></li>
          <li><a href="#" class="hover:text-gray-400 transition-all">Terms of Service</a></li>
          <li><a href="#" class="hover:text-gray-400 transition-all">Contact Us</a></li>
        </ul>
      </div>
      
      <!-- Popular Evergreen Topics -->
      <div>
        <h4 class="text-lg font-semibold mb-3">Popular Topics</h4>
        <ul class="space-y-2">
          <li><a href="#" class="hover:text-gray-400 transition-all">Timeless Tips</a></li>
          <li><a href="#" class="hover:text-gray-400 transition-all">Success Stories</a></li>
          <li><a href="#" class="hover:text-gray-400 transition-all">Financial Wisdom</a></li>
        </ul>
      </div>
      
      <!-- Featured Collections -->
      <div>
        <h4 class="text-lg font-semibold mb-3">Featured Collections</h4>
        <ul class="space-y-2">
          <li><a href="#" class="hover:text-gray-400 transition-all">Life Lessons</a></li>
          <li><a href="#" class="hover:text-gray-400 transition-all">Productivity Hacks</a></li>
          <li><a href="#" class="hover:text-gray-400 transition-all">Business Foundations</a></li>
        </ul>
      </div>
    </div>

    <!-- Bottom Section: Search and Copyright -->
    <div class="mt-12 border-t border-gray-800 pt-6 flex flex-col md:flex-row justify-between items-center">
      <div class="mb-4 md:mb-0">
        <h4 class="text-lg font-semibold">Explore More</h4>
        <form class="flex mt-2">
          <input type="text" placeholder="Search timeless content..." 
                 class="p-2 rounded-l-md w-64 bg-gray-800 border border-gray-700 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500">
          <button type="submit" class="bg-red-600 text-white px-4 rounded-r-md hover:bg-red-500 transition-all">Search</button>
        </form>
      </div>
      
      <p class="text-sm">&copy; 2024 Bright Facts Articles. All Rights Reserved.</p>
    </div>
  </div>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
  import { getDatabase, ref, push, onValue,get, set } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

  const firebaseConfig = {
      apiKey: "AIzaSyDv6Xp4ZYnF4wuAEvSFOez_Gluus3hrlIE",
      authDomain: "content-blog-3ba6d.firebaseapp.com",
      databaseURL: "https://content-blog-3ba6d-default-rtdb.firebaseio.com/",
      projectId: "content-blog-3ba6d",
      storageBucket: "content-blog-3ba6d.appspot.com",
      messagingSenderId: "687597872642",
      appId: "1:687597872642:web:79d50fb69ed451e020e91b",
      measurementId: "G-YM6PNBB100"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  // Utility to get URL parameters
  function getUrlParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
  }

  // Toggle mobile menu
  document.getElementById('menu-toggle').addEventListener('click', () => {
      const menu = document.getElementById('mobile-menu');
      menu.classList.toggle('hidden');
  });

  function loadArticle() {
    const id = getUrlParameter('id');
    if (!id) {
        document.getElementById('article-title').innerText = 'Content Not Available';
        document.getElementById('breadcrumb-title').innerText = 'Content Not Available';
        return;
    }

    // Define references for articles and trending news
    const articlesRef = ref(database, `articles/${id}`);
    const trendingNewsRef = ref(database, `trending-news/${id}`);

    // First try fetching from articles
    onValue(articlesRef, (snapshot) => {
        const foundArticle = snapshot.val();
        if (foundArticle) {
            displayArticle(foundArticle);
        } else {
            // If no article is found, try fetching from trending news
            onValue(trendingNewsRef, (snapshot) => {
                const foundTrendingNews = snapshot.val();
                if (foundTrendingNews) {
                    displayArticle(foundTrendingNews);
                } else {
                    displayNotFound();
                }
            }, handleError);
        }
    }, handleError);
}

// Helper to display the content
function displayArticle(article) {
    document.getElementById('article-title').innerText = article.title;
    document.getElementById('breadcrumb-title').innerText = article.title;
    document.getElementById('breadcrumb-title').style.color = 'lightgrey';

    const contentContainer = document.getElementById('article-content');
    contentContainer.innerHTML = '';

    if (article.image) {
        contentContainer.innerHTML += `<img src="${article.image}" alt="${article.title}" class="w-full h-auto my-4">`;
    }
    if (article.video) {
        let videoUrl = article.video.trim();
        if (videoUrl.includes("youtube.com") || videoUrl.includes("youtu.be")) {
            videoUrl = videoUrl.replace("youtube.com/watch?v=", "youtube.com/embed/").replace("youtu.be/", "youtube.com/embed/");
        }
        if (videoUrl.includes("youtube.com/embed/")) {
            contentContainer.innerHTML += `<iframe src="${videoUrl}" class="w-full h-64 my-4" frameborder="0" allowfullscreen></iframe>`;
        } else {
            contentContainer.innerHTML += `<p>Invalid or unsupported video URL.</p>`;
        }
    }
    contentContainer.innerHTML += `<div>${article.content}</div>`;
}

// Helper to display "not found" content
function displayNotFound() {
    document.getElementById('article-title').innerText = 'Content Not Available';
    document.getElementById('breadcrumb-title').innerText = 'Content Not Available';
    document.getElementById('article-content').innerHTML = 'Content Not Available';
}

// Error handler
function handleError(error) {
    console.error("Error fetching article:", error);
}
// Function to fetch trending news
function fetchTrendingNews() {
    const trendingNewsRef = ref(database, 'trending-news');
    
    // Fetch trending news from Firebase
    onValue(trendingNewsRef, (snapshot) => {
        const trendingNews = snapshot.val();
        const trendingNewsList = document.getElementById('trending-news');
        trendingNewsList.innerHTML = '';  // Clear existing content

        if (trendingNews) {
            // Convert the object to an array
            const newsArray = Object.values(trendingNews);

            // Shuffle the array
            shuffleArray(newsArray);

            // Loop through the shuffled array
            newsArray.forEach((newsItem) => {
                console.log(newsItem);  // Debug log

                // Skip if the article is a preview
                if (newsItem.preview && newsItem.preview === true) {
                    console.log(`Skipping preview article: ${newsItem.title}`);
                    return; // Skip this news item
                }

                const timestamp = new Date(newsItem.timestamp).toLocaleString();
                const encodedId = encodeURIComponent(newsItem.id);  // Encode ID safely
                const image = newsItem.image ? `<img src="${newsItem.image}" alt="${newsItem.title}" class="w-16 h-16 object-cover rounded">` : '';

                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <div class="border-b pb-2 mb-2 flex items-start">
                        ${image}
                        <div class="ml-4 flex-1">
                            <a href="reading.html?id=${encodedId}" class="font-bold text-red-600 hover:underline">${newsItem.title}</a>
                            <p class="text-sm text-gray-500">${timestamp}</p>
                        </div>
                    </div>
                `;
                trendingNewsList.appendChild(listItem);
            });
        } else {
            trendingNewsList.innerHTML = '<li>No trending news available.</li>';
        }
    }, (error) => {
        console.error("Error fetching trending news: ", error);
    });
}

// Function to shuffle an array (Fisher-Yates shuffle)
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1)); // Get a random index
        [array[i], array[j]] = [array[j], array[i]]; // Swap elements
    }
}


// Load article and trending news on page load
document.addEventListener('DOMContentLoaded', () => {
    loadArticle();  // Function to load article (already defined in your code)
    fetchTrendingNews();  // Call the function to fetch trending news
    const articleId = getUrlParameter('id');
    if (articleId) {
        loadComments(articleId);  // Function to load comments (already defined in your code)
    }
});

  // Load and display comments for an article
  function loadComments(articleId) {
      const commentsRef = ref(database, `comments/${articleId}`);
      onValue(commentsRef, (snapshot) => {
          const commentsList = document.getElementById('comments-list');
          commentsList.innerHTML = '';

          let commentsArray = [];
          snapshot.forEach((childSnapshot) => {
              commentsArray.push(childSnapshot.val());
          });

          const maxVisibleComments = 3;
          const initialComments = commentsArray.slice(0, maxVisibleComments);

          initialComments.forEach(commentData => {
              commentsList.appendChild(createCommentElement(commentData));
          });

          if (commentsArray.length > maxVisibleComments) {
              const viewMoreButton = document.createElement('button');
              viewMoreButton.textContent = 'View More Comments';
              viewMoreButton.className = 'mt-2 text-blue-600 hover:underline';
              viewMoreButton.addEventListener('click', () => {
                  commentsList.innerHTML = '';
                  commentsArray.forEach(commentData => {
                      commentsList.appendChild(createCommentElement(commentData));
                  });
                  viewMoreButton.remove();
              });
              commentsList.appendChild(viewMoreButton);
          }
      });
  }

  // Helper function to create a comment element
  function createCommentElement(commentData) {
      const commentDiv = document.createElement('div');
      commentDiv.classList.add('p-4', 'border', 'rounded-lg', 'bg-gray-100', 'mb-2');
      commentDiv.innerHTML = `
          <p class="font-bold">${commentData.name}</p>
          <p class="text-sm text-gray-500">${new Date(commentData.timestamp).toLocaleString()}</p>
          <p class="mt-1">${commentData.content}</p>`;
      return commentDiv;
  }

  // Post new comment
  document.getElementById('comment-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const nameInput = document.getElementById('commenter-name');
      const commentInput = document.getElementById('comment-input');
      const name = nameInput.value.trim();
      const content = commentInput.value.trim();
      const articleId = getUrlParameter('id');

      if (name && content && articleId) {
          const commentsRef = ref(database, `comments/${articleId}`);
          push(commentsRef, {
              name,
              content,
              timestamp: Date.now()
          }).then(() => {
              nameInput.value = '';
              commentInput.value = '';
          }).catch((error) => {
              console.error('Error posting comment:', error);
          });
      }
  });
// Function to sanitize the email for Firebase path
function sanitizeEmail(email) {
    return email.replace(/@/g, '_at_').replace(/\./g, '_dot_');
}
// Subscription form handler
document.getElementById('subscription-form').addEventListener('submit', function (event) {
    event.preventDefault();
    const email = this.querySelector('input[type="email"]').value;

    // Message container elements
    const messageContainer = document.getElementById('message-container');
    const messageText = document.getElementById('message-text');

    // Clear any previous messages
    messageContainer.classList.add('hidden');
    messageText.textContent = '';

    if (email) {
        // Sanitize the email to make it safe for Firebase paths
        const sanitizedEmail = sanitizeEmail(email);

        // Get reference to the 'subscribers' node
        const subscribersRef = ref(getDatabase(), 'subscribers'); // The 'subscribers' node

        // Check if email already exists in the database
        get(subscribersRef).then((snapshot) => {
            let emailExists = false;
            
            if (snapshot.exists()) {
                // Check if the email already exists under 'subscribers' node
                const subscribers = snapshot.val();
                for (let key in subscribers) {
                    if (subscribers[key].email === email) {
                        emailExists = true;
                        break;
                    }
                }
            }

            if (emailExists) {
                // Email already exists in the database
                messageText.textContent = `The email address ${email} has already been subscribed.`;
                messageText.classList.add('text-red-500');  // Error message
                messageContainer.classList.remove('hidden');
            } else {
                // Email doesn't exist, so add it to the 'subscribers' node
                const newSubscriberRef = push(subscribersRef); // Push creates a new unique key under 'subscribers'
                set(newSubscriberRef, {
                    email: email,
                    timestamp: Date.now()
                }).then(() => {
                    messageText.textContent = `Successfully subscribed with email: ${email}`;
                    messageText.classList.add('text-green-500');  // Success message
                    messageContainer.classList.remove('hidden');
                    this.reset();
                }).catch((error) => {
                    console.error('Error subscribing email: ', error);
                    messageText.textContent = 'An error occurred while subscribing. Please try again later.';
                    messageText.classList.add('text-red-500');  // Error message
                    messageContainer.classList.remove('hidden');
                });
            }
        }).catch((error) => {
            console.error("Error checking email: ", error);
            messageText.textContent = 'An error occurred while checking the email. Please try again later.';
            messageText.classList.add('text-red-500');  // Error message
            messageContainer.classList.remove('hidden');
        });
    } else {
        messageText.textContent = 'Please enter a valid email address.';
        messageText.classList.add('text-red-500');  // Error message
        messageContainer.classList.remove('hidden');
    }
});
  // Load article, comments, and trending news on page load
  document.addEventListener('DOMContentLoaded', () => {
      loadArticle();
      fetchTrendingNews();
      const articleId = getUrlParameter('id');
      if (articleId) {
          loadComments(articleId);
      }
  });
</script>

    
</body>
</html>
